# 📊 部署流程图

**可视化部署流程** | 一图看懂整个部署过程

---

## 🎯 完整部署流程

```
┌─────────────────────────────────────────────────────────────┐
│                     开始部署                                 │
│                    (15 分钟)                                 │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  第 1 步：准备工作 (2 分钟)                                  │
├─────────────────────────────────────────────────────────────┤
│  □ 注册 GitHub 账号                                          │
│  □ 注册 Railway 账号                                         │
│  □ 阅读部署文档                                              │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  第 2 步：推送代码 (2 分钟)                                  │
├─────────────────────────────────────────────────────────────┤
│  $ git add .                                                 │
│  $ git commit -m "Deploy to Railway"                         │
│  $ git push origin main                                      │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  第 3 步：创建 Railway 项目 (1 分钟)                         │
├─────────────────────────────────────────────────────────────┤
│  1. 访问 https://railway.app/dashboard                       │
│  2. 点击 "New Project"                                       │
│  3. 选择 "Deploy from GitHub repo"                           │
│  4. 选择你的仓库                                             │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  第 4 步：添加数据库 (1 分钟)                                │
├─────────────────────────────────────────────────────────────┤
│  1. 点击 "New"                                               │
│  2. 选择 "Database"                                          │
│  3. 选择 "PostgreSQL"                                        │
│  4. 等待创建完成                                             │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  第 5 步：配置后端 (3 分钟)                                  │
├─────────────────────────────────────────────────────────────┤
│  环境变量：                                                  │
│  • DATABASE_URL=${{Postgres.DATABASE_URL}}                   │
│  • JWT_SECRET=<生成随机字符串>                               │
│  • NODE_ENV=production                                       │
│  • PORT=5000                                                 │
│                                                              │
│  生成域名：Settings → Generate Domain                        │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  第 6 步：配置前端 (3 分钟)                                  │
├─────────────────────────────────────────────────────────────┤
│  环境变量：                                                  │
│  • VITE_API_URL=https://后端地址.railway.app/api             │
│                                                              │
│  生成域名：Settings → Generate Domain                        │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  第 7 步：更新 CORS (1 分钟)                                 │
├─────────────────────────────────────────────────────────────┤
│  在后端服务添加：                                            │
│  • CORS_ORIGIN=https://前端地址.railway.app                  │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  第 8 步：测试验证 (2 分钟)                                  │
├─────────────────────────────────────────────────────────────┤
│  □ 访问前端地址                                              │
│  □ 测试注册登录                                              │
│  □ 测试创建项目                                              │
│  □ 检查所有功能                                              │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                   部署完成！🎉                               │
│                                                              │
│  前端：https://你的应用.railway.app                          │
│  后端：https://你的应用-backend.railway.app                  │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔄 服务架构图

```
┌─────────────────────────────────────────────────────────────┐
│                      Railway 项目                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐  │
│  │   前端服务   │    │   后端服务   │    │  PostgreSQL  │  │
│  │   (React)    │───▶│  (Express)   │───▶│   数据库     │  │
│  │              │    │              │    │              │  │
│  │  Port: 3000  │    │  Port: 5000  │    │ Port: 5432   │  │
│  │              │    │              │    │              │  │
│  │  域名: ✓     │    │  域名: ✓     │    │  内部访问    │  │
│  └──────────────┘    └──────────────┘    └──────────────┘  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
         │                     │                     │
         │                     │                     │
         ▼                     ▼                     ▼
    HTTPS 访问            API 调用              数据存储
```

---

## 🎨 环境变量配置图

```
┌─────────────────────────────────────────────────────────────┐
│                      后端环境变量                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  DATABASE_URL ──────────┐                                    │
│  DB_HOST ───────────────┤                                    │
│  DB_PORT ───────────────┼──▶ 连接 PostgreSQL                │
│  DB_NAME ───────────────┤                                    │
│  DB_USER ───────────────┤                                    │
│  DB_PASSWORD ───────────┘                                    │
│                                                              │
│  JWT_SECRET ────────────────▶ 用户认证                       │
│  NODE_ENV ──────────────────▶ 生产环境                       │
│  PORT ──────────────────────▶ 服务端口                       │
│  CORS_ORIGIN ───────────────▶ 允许前端访问                   │
│                                                              │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      前端环境变量                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  VITE_API_URL ──────────────▶ 后端 API 地址                 │
│  GEMINI_API_KEY ────────────▶ AI 功能（可选）               │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔐 数据流向图

```
┌──────────┐                                    ┌──────────┐
│  用户    │                                    │  数据库  │
│ (浏览器) │                                    │(Postgres)│
└────┬─────┘                                    └────▲─────┘
     │                                               │
     │ 1. HTTPS 请求                                 │
     │    (https://前端.railway.app)                 │
     ▼                                               │
┌─────────────┐                                     │
│   前端服务  │                                     │
│   (React)   │                                     │
└─────┬───────┘                                     │
      │                                             │
      │ 2. API 调用                                 │
      │    (https://后端.railway.app/api)           │
      ▼                                             │
┌─────────────┐                                     │
│   后端服务  │                                     │
│  (Express)  │                                     │
│             │                                     │
│  ┌────────┐ │                                     │
│  │ 认证   │ │ 3. JWT 验证                         │
│  └────────┘ │                                     │
│  ┌────────┐ │                                     │
│  │ 权限   │ │ 4. 权限检查                         │
│  └────────┘ │                                     │
│  ┌────────┐ │                                     │
│  │ 业务   │ │ 5. 业务逻辑                         │
│  └────────┘ │                                     │
└─────┬───────┘                                     │
      │                                             │
      │ 6. SQL 查询                                 │
      └─────────────────────────────────────────────┘
```

---

## 📊 部署决策树

```
                    开始部署
                       │
                       ▼
              有 GitHub 账号？
                   ╱   ╲
                 是      否
                ╱         ╲
               ▼           ▼
          推送代码      注册 GitHub
               │           │
               └─────┬─────┘
                     ▼
              有 Railway 账号？
                   ╱   ╲
                 是      否
                ╱         ╲
               ▼           ▼
          创建项目      注册 Railway
               │           │
               └─────┬─────┘
                     ▼
              选择部署方式
                   ╱   ╲
                 ╱       ╲
          自动脚本      手动部署
             ╱               ╲
            ▼                 ▼
    运行 deploy-railway    查看文档
            │                 │
            └────────┬────────┘
                     ▼
              配置环境变量
                     │
                     ▼
              生成域名
                     │
                     ▼
              测试验证
                     │
                     ▼
              部署完成！🎉
```

---

## 🎯 快速决策指南

### 我应该选择哪种部署方式？

```
┌─────────────────────────────────────────────────────────────┐
│  你的情况                    │  推荐方式                     │
├─────────────────────────────────────────────────────────────┤
│  第一次部署                  │  自动脚本 + DEPLOY_NOW.md     │
│  有部署经验                  │  RAILWAY_QUICK_REFERENCE.md   │
│  需要完全掌控                │  手动部署 + 详细文档          │
│  快速测试                    │  自动脚本                     │
│  生产环境                    │  手动部署 + 检查清单          │
└─────────────────────────────────────────────────────────────┘
```

### 我需要哪些文档？

```
┌─────────────────────────────────────────────────────────────┐
│  你的需求                    │  推荐文档                     │
├─────────────────────────────────────────────────────────────┤
│  快速开始                    │  开始部署.md                  │
│  详细教程                    │  DEPLOY_NOW.md                │
│  快速查询                    │  RAILWAY_QUICK_REFERENCE.md   │
│  检查验证                    │  部署检查清单.md              │
│  记录信息                    │  我的部署记录.md              │
│  方案对比                    │  免费部署方案.md              │
└─────────────────────────────────────────────────────────────┘
```

---

## 🚀 开始部署

准备好了吗？选择你的方式开始部署：

### 方式 1：自动脚本（推荐）

```powershell
# Windows
.\deploy-railway.ps1

# Mac/Linux
bash deploy-railway.sh
```

### 方式 2：手动部署

1. 打开 `开始部署.md`
2. 按照步骤操作
3. 使用 `部署检查清单.md` 验证

---

**祝你部署顺利！** 🎉
