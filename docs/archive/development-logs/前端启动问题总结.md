# 前端启动问题总结

**时间**: 2026-01-30  
**问题**: 前端容器无法通过 localhost:3000 访问  
**状态**: 需要手动解决

---

## 问题描述

前端 Docker 容器已成功启动，但无法通过 `http://localhost:3000` 访问。主要问题：

1. **端口映射问题**: Docker Compose 配置了 `3000:80` 端口映射，但实际容器没有映射到主机端口
2. **容器内部正常**: Nginx 在容器内部正常工作，可以返回正确的 HTML
3. **其他容器正常**: 后端 (5000) 和数据库 (5432) 的端口映射都正常工作

---

## 当前状态

### ✅ 正常运行的服务
- PostgreSQL: `localhost:5432` ✅
- 后端 API: `localhost:5000` ✅
- 后端健康检查: `http://localhost:5000/health` ✅ 200 OK

### ❌ 问题服务
- 前端应用: `localhost:3000` ❌ 无法访问
- 容器状态: 运行中，但端口未映射

### 容器信息
```
CONTAINER ID   IMAGE           STATUS          PORTS
fffa4b9aa02a   blue-frontend   Up 12 hours     80/tcp (未映射到主机)
55109a6d6734   blue-backend    Up 16 hours     0.0.0.0:5000->5000/tcp ✅
a9a82a6cc06e   postgres:15     Up 16 hours     0.0.0.0:5432->5432/tcp ✅
```

---

## 已尝试的解决方案

### 1. 修改 Nginx 配置 ✅
- 简化了 Nginx 配置，移除了 API 代理
- 配置已正确应用到容器中
- 容器内部 Nginx 工作正常

### 2. 重建 Docker 镜像 ✅
- 多次重建前端镜像
- 镜像构建成功，包含正确的文件

### 3. 删除并重新创建容器 ✅
- 使用 `docker-compose down` 和 `docker-compose up -d`
- 使用 `docker run` 手动创建容器
- 问题仍然存在

### 4. 检查 docker-compose.yml ✅
- 配置正确：`ports: - "3000:80"`
- 删除了过时的 `version` 属性
- 其他容器的端口映射正常工作

### 5. 测试端口映射 ✅
- 创建测试 Nginx 容器，端口映射正常工作
- 说明 Docker Desktop 的端口映射功能正常

---

## 可能的原因

### 1. Docker Desktop WSL2 网络问题
- Windows 上的 Docker Desktop 使用 WSL2
- 可能存在网络配置问题
- 端口映射可能被防火墙或网络策略阻止

### 2. 容器启动顺序问题
- 前端容器依赖后端容器
- 可能在启动时出现了问题

### 3. Docker Compose 版本问题
- Docker Compose v5.0.0 可能存在 bug
- 端口映射可能不一致

---

## 建议的解决方案

### 方案 1: 使用本地开发服务器（推荐）

不使用 Docker 容器，直接在本地运行前端开发服务器：

```bash
# 1. 安装依赖
npm install

# 2. 启动开发服务器
npm run dev

# 3. 访问
# http://localhost:3000
```

**优点**:
- 开发体验更好
- 热重载支持
- 调试更方便
- 不依赖 Docker

**缺点**:
- 需要本地安装 Node.js
- 不是生产环境配置

### 方案 2: 手动映射端口

使用 `docker run` 手动创建容器并映射端口：

```bash
# 1. 停止现有容器
docker stop blueprint_frontend
docker rm blueprint_frontend

# 2. 手动创建容器
docker run -d \
  --name blueprint_frontend \
  -p 3000:80 \
  --network blue_blueprint_network \
  blue-frontend

# 3. 检查端口映射
docker port blueprint_frontend

# 4. 访问
# http://localhost:3000
```

### 方案 3: 使用 host 网络模式

修改 docker-compose.yml，使用 host 网络模式：

```yaml
frontend:
  build:
    context: .
    dockerfile: Dockerfile
  container_name: blueprint_frontend
  network_mode: "host"  # 使用主机网络
  restart: unless-stopped
```

**注意**: host 网络模式在 Windows 上可能不工作

### 方案 4: 重启 Docker Desktop

完全重启 Docker Desktop：

```bash
# 1. 停止所有容器
docker-compose down

# 2. 关闭 Docker Desktop
# 在任务管理器中结束 Docker Desktop 进程

# 3. 重新启动 Docker Desktop
# 从开始菜单启动

# 4. 等待 Docker 完全启动

# 5. 重新启动容器
docker-compose up -d
```

### 方案 5: 使用不同的端口

尝试使用不同的端口，避免端口冲突：

```yaml
frontend:
  ports:
    - "8080:80"  # 使用 8080 而不是 3000
```

---

## 立即可用的解决方案

### 选项 A: 使用本地开发服务器（最简单）

```bash
# 在项目根目录运行
npm install
npm run dev
```

然后访问 `http://localhost:5173`（Vite 默认端口）

### 选项 B: 直接访问容器 IP（临时方案）

```bash
# 1. 获取容器 IP
docker inspect blueprint_frontend | grep IPAddress

# 2. 访问容器 IP
# http://172.18.0.4/
```

**注意**: 这个方法可能返回 502 错误，因为 Nginx 配置问题

### 选项 C: 使用后端 API 直接测试

后端 API 已正常工作，可以直接测试：

```bash
# 健康检查
curl http://localhost:5000/health

# 测试 API
curl http://localhost:5000/api/projects
```

---

## 下一步行动

### 立即行动
1. **使用本地开发服务器**（推荐）
   ```bash
   npm install
   npm run dev
   ```

2. **或者重启 Docker Desktop**
   - 完全关闭 Docker Desktop
   - 重新启动
   - 运行 `docker-compose up -d`

### 长期解决方案
1. 升级或降级 Docker Desktop 版本
2. 检查 Windows 防火墙设置
3. 检查 WSL2 网络配置
4. 考虑使用 Linux 虚拟机进行开发

---

## 系统信息

- **操作系统**: Windows with WSL2
- **Docker Desktop**: 使用 WSL2 后端
- **Docker Compose**: v5.0.0-desktop.1
- **前端镜像**: blue-frontend (Nginx + React)
- **后端镜像**: blue-backend (Node.js + Express)
- **数据库**: PostgreSQL 15-Alpine

---

## 相关文档

- `STARTUP_VERIFICATION_REPORT.md` - 启动验证报告
- `QUICK_STARTUP_COMMANDS.md` - 快速启动命令
- `启动完成总结.md` - 启动完成总结
- `README_启动指南.md` - 启动指南

---

## 联系支持

如果问题仍然存在，请：
1. 检查 Docker Desktop 日志
2. 检查 Windows 事件查看器
3. 尝试在 Linux 环境中运行
4. 考虑使用虚拟机

---

**最后更新**: 2026-01-30  
**状态**: 需要手动解决  
**推荐方案**: 使用本地开发服务器 (`npm run dev`)
